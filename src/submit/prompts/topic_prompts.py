"""
Тематические промпты для RAG системы
"""
from typing import Dict


def get_topic_prompt(topic: str, question: str, memory_text: str) -> str:
    """
    Получить тематический промпт для конкретной темы
    
    Args:
        topic: Название темы
        question: Вопрос пользователя
        memory_text: Текст памяти с сообщениями
        
    Returns:
        Готовый промпт для модели
    """
    base_prompt = f"""ТЫ - ЭКСПЕРТ ПО АНАЛИЗУ ЛИЧНОЙ ИНФОРМАЦИИ! Найди точные факты о пользователе из его сообщений.

ЭТАП 1 - АНАЛИЗ ВОПРОСА:
Разбери вопрос "{question}" по словам. Пойми суть: что именно нужно найти?

ЭТАП 2 - СТРУКТУРА СЕССИЙ:
Сообщения идут хронологически: Сессия 1 → Сессия 25
При противоречиях - бери из ПОЗДНЕЙ сессии

ЭТАП 3 - ПРОВЕРКА:
Найди сообщения с ответом на вопрос.
Перечитай их 2-3 раза, дочитывай до конца фраз.

ЭТАП 4 - ОТВЕТ:
Найди ответ на "{question}". Отвечай кратко 1 предложением!

ПРАВИЛА:
• Найден факт → четкий ответ
• Косвенные упоминания тоже считаются
• Нет данных → "У меня нет такой информации"
• Несколько вариантов → через запятую

ФОРМАТ: Краткий ответ или "У меня нет такой информации"

СООБЩЕНИЯ:
{memory_text}"""

    # Добавляем тематическую специфику
    topic_specific = TOPIC_SPECIFIC_PROMPTS.get(topic, "")
    if topic_specific:
        return f"{base_prompt}\n\n{topic_specific}"
    
    return base_prompt


# Тематические дополнения к базовому промпту
TOPIC_SPECIFIC_PROMPTS = {
    "sports": """
ОСОБОЕ ВНИМАНИЕ - СПОРТ:
• Ищи упоминания конкретных видов спорта, тренировок, соревнований
• Обращай внимание на регулярность занятий, достижения, планы
• Учитывай изменения в спортивных предпочтениях со временем""",

    "work": """
ОСОБОЕ ВНИМАНИЕ - РАБОТА:
• Ищи информацию о профессии, должности, компании
• Обращай внимание на изменения в карьере, проектах, коллегах
• Учитывай планы на будущее, обучение, развитие""",

    "family": """
ОСОБОЕ ВНИМАНИЕ - СЕМЬЯ:
• Ищи информацию о родственниках, их именах, отношениях
• Обращай внимание на семейные события, планы, традиции
• Учитывай изменения в семейном положении, составе семьи""",

    "hobbies": """
ОСОБОЕ ВНИМАНИЕ - ХОББИ:
• Ищи упоминания увлечений, коллекций, творческих занятий
• Обращай внимание на развитие навыков, новые интересы
• Учитывай время, которое уделяется хобби, планы""",

    "travel": """
ОСОБОЕ ВНИМАНИЕ - ПУТЕШЕСТВИЯ:
• Ищи информацию о поездках, местах, планах на отпуск
• Обращай внимание на предпочтения в отдыхе, отелях, маршрутах
• Учитывай изменения в туристических предпочтениях""",

    "health": """
ОСОБОЕ ВНИМАНИЕ - ЗДОРОВЬЕ:
• Ищи информацию о болезнях, лечении, врачах, лекарствах
• Обращай внимание на изменения в состоянии здоровья
• Учитывай планы по лечению, профилактике, диете""",

    "food": """
ОСОБОЕ ВНИМАНИЕ - ЕДА:
• Ищи упоминания любимых блюд, ресторанов, рецептов
• Обращай внимание на пищевые предпочтения, аллергии, диеты
• Учитывай изменения во вкусах, новых открытиях в кулинарии""",

    "pets": """
ОСОБОЕ ВНИМАНИЕ - ЖИВОТНЫЕ:
• Ищи информацию о питомцах: имена, породы, характеры
• Обращай внимание на уход, кормление, здоровье животных
• Учитывай планы по заведению новых питомцев""",

    "shopping": """
ОСОБОЕ ВНИМАНИЕ - ПОКУПКИ:
• Ищи упоминания любимых магазинов, брендов, товаров
• Обращай внимание на предпочтения в одежде, технике, товарах
• Учитывай планы на покупки, бюджет, скидки""",

    "education": """
ОСОБОЕ ВНИМАНИЕ - ОБРАЗОВАНИЕ:
• Ищи информацию об учебных заведениях, курсах, предметах
• Обращай внимание на планы по обучению, развитию навыков
• Учитывай достижения, сертификаты, дипломы"""
}


def get_all_topic_names() -> list:
    """Получить список всех доступных тем"""
    return list(TOPIC_SPECIFIC_PROMPTS.keys())

