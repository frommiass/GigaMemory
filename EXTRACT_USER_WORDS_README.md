# Скрипт извлечения слов пользователя

## Описание

Скрипт `extract_user_words.py` извлекает только слова пользователя из диалогов и сохраняет их в отдельные файлы, пронумерованные по сессиям.

## Возможности

- ✅ Извлечение слов только из сообщений пользователя
- ✅ Фильтрация копипаста (длинные тексты, вопросы, рекомендации)
- ✅ Группировка по сессиям и диалогам
- ✅ Два формата вывода: TXT и JSON
- ✅ Статистика по словам и сессиям
- ✅ Топ самых частых слов

## Использование

### Базовое использование
```bash
python extract_user_words.py --input data/format_example.jsonl --output user_words_output
```

### С параметрами
```bash
python extract_user_words.py \
  --input test_dialogue_100k.jsonl \
  --output user_words_large \
  --format json \
  --min-words 5
```

## Параметры

- `--input` - Путь к входному файлу (JSON или JSONL) **[обязательный]**
- `--output` - Путь для сохранения результатов (по умолчанию: `./user_words_output`)
- `--format` - Формат выходных файлов: `txt` или `json` (по умолчанию: `txt`)
- `--min-words` - Минимальное количество слов в сообщении (по умолчанию: 3)

## Структура выходных файлов

### TXT формат
```
user_words_output/
├── dialogue_1/
│   ├── session_1.txt
│   ├── session_3.txt
│   └── ...
├── dialogue_2/
│   ├── session_2.txt
│   └── ...
└── summary.txt
```

### JSON формат
```json
{
  "dialogue_id": 1,
  "session_id": 1,
  "total_words": 61,
  "words": ["исполнилось", "мне", "значит", ...],
  "unique_words": ["исполнилось", "мне", "значит", ...],
  "unique_count": 55
}
```

## Фильтрация

Скрипт автоматически фильтрует:

1. **Сообщения не от пользователя** - только `role: "user"`
2. **Копипаст контент**:
   - Длинные сообщения (>200 символов)
   - Вопросы (содержат `?`, `что`, `где`, `как` и т.д.)
   - Рекомендации (`посоветуй`, `расскажи`, `что можно` и т.д.)
3. **Короткие сообщения** - менее указанного количества слов

## Примеры использования

### Тестовый запуск
```bash
python extract_user_words.py --input data/format_example.jsonl --output test_output
```

### Обработка большого диалога
```bash
python extract_user_words.py --input test_dialogue_100k.jsonl --output large_output --format json
```

### Строгая фильтрация
```bash
python extract_user_words.py --input data.jsonl --output filtered --min-words 10
```

## Результаты

После выполнения скрипт создает:

1. **Отдельные файлы** для каждой сессии с словами пользователя
2. **Сводный файл** `summary.txt` со статистикой:
   - Общее количество диалогов, сессий, слов
   - Статистика по каждому диалогу и сессии
   - Топ-20 самых частых слов

## Статистика

Пример статистики:
```
Всего диалогов: 4
Всего сессий: 118
Всего слов: 3031

ТОП-20 САМЫХ ЧАСТЫХ СЛОВ:
я: 99
не: 72
и: 72
в: 70
на: 60
...
```

## Требования

- Python 3.6+
- Стандартные библиотеки (json, pathlib, re, argparse)
