# üöÄ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –≤ GigaMemory

## üìä –û–±–∑–æ—Ä

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —É–ª—É—á—à–µ–Ω–Ω–æ–≥–æ –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø—Ä–æ–µ–∫—Ç GigaMemory. –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–µ –∏ –±—ã—Å—Ç—Ä–æ–µ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤.

### ‚ú® –ö–ª—é—á–µ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ | –ü—Ä–∏—Ä–æ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ |
|-----------|------------|---------------------------|
| **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** | AMP, torch.compile, –∫–≤–∞–Ω—Ç–∏–∑–∞—Ü–∏—è, –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º | –î–æ 5x –±—ã—Å—Ç—Ä–µ–µ |
| **–ö–∞—á–µ—Å—Ç–≤–æ –ø–æ–∏—Å–∫–∞** | 6 –º–µ—Ç—Ä–∏–∫, 5 —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –ø—É–ª–∏–Ω–≥–∞, –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ | +30% —Ç–æ—á–Ω–æ—Å—Ç—å |
| **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** | Thread-safe, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞–º—è—Ç–∏, —Å–∂–∞—Ç–∏–µ | –î–æ 1M –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ |
| **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞** | –ú–µ—Ç—Ä–∏–∫–∏, –æ–±—ä—è—Å–Ω–µ–Ω–∏—è, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ | –ü–æ–ª–Ω–∞—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å |

## üéØ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

```
VectorRAGInterface (Drop-in –∑–∞–º–µ–Ω–∞)
‚îú‚îÄ‚îÄ ImprovedEmbeddingEngine (AMP, torch.compile, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ)
‚îú‚îÄ‚îÄ ImprovedVectorStore (–≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞)
‚îú‚îÄ‚îÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
‚îî‚îÄ‚îÄ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º RAGInterface
```

## üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Python 3.8+
- PyTorch 1.10+
- Transformers 4.30+
- 2GB RAM (4GB —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- GPU –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (CUDA 11.0+)

### –ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

–í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ–∞–π–ª—ã —É–∂–µ —Å–æ–∑–¥–∞–Ω—ã –≤ –ø—Ä–æ–µ–∫—Ç–µ:

```bash
# –§–∞–π–ª—ã —É–∂–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö:
src/submit/rag/vector_rag_interface.py          # Drop-in –∑–∞–º–µ–Ω–∞
src/submit/embeddings/improved_vector_search.py # –£–ª—É—á—à–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
src/submit/model_inference_vector.py            # –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å
```

## üéØ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü—Ä–æ—Å—Ç–∞—è –∑–∞–º–µ–Ω–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```python
# –í —Ñ–∞–π–ª–µ src/submit/model_inference.py –∑–∞–º–µ–Ω–∏—Ç–µ:

# –ë–´–õ–û:
from .rag.engine import RAGEngine
self.rag_interface = RAGEngine()

# –°–¢–ê–õ–û:
from .rag.vector_rag_interface import VectorRAGInterface
self.rag_interface = VectorRAGInterface(
    model_name="cointegrated/rubert-tiny2",
    use_gpu=True,
    enable_hybrid_search=True
)
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–æ–≥–æ –∫–ª–∞—Å—Å–∞

```python
# –ó–∞–º–µ–Ω–∏—Ç–µ –∏–º–ø–æ—Ä—Ç:
from .model_inference_vector import SubmitModelWithVectorMemory

# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–æ–≤—ã–π –∫–ª–∞—Å—Å:
class SubmitModelWithMemory(SubmitModelWithVectorMemory):
    def __init__(self, model_path: str) -> None:
        super().__init__(
            model_path=model_path,
            use_vector_rag=True,  # –í–∫–ª—é—á–∏—Ç—å –≤–µ–∫—Ç–æ—Ä–Ω—ã–π RAG
            vector_model="cointegrated/rubert-tiny2",
            use_gpu=True,
            enable_hybrid_search=True
        )
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```python
def __init__(self, model_path: str, use_vector_rag: bool = True):
    if use_vector_rag:
        from .rag.vector_rag_interface import VectorRAGInterface
        self.rag_interface = VectorRAGInterface()
    else:
        from .rag.engine import RAGEngine
        self.rag_interface = RAGEngine()  # –°—Ç–∞—Ä—ã–π RAG
```

## üìñ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä

```python
from src.submit.rag.vector_rag_interface import VectorRAGInterface

# –°–æ–∑–¥–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
rag = VectorRAGInterface(
    model_name="cointegrated/rubert-tiny2",
    use_gpu=True,
    enable_hybrid_search=True
)

# –î–æ–±–∞–≤–ª—è–µ–º –¥–∏–∞–ª–æ–≥
dialogue_id = "user_123"
messages = [
    {"role": "user", "content": "–ú–µ–Ω—è –∑–æ–≤—É—Ç –ê–ª–µ–∫—Å–∞–Ω–¥—Ä"},
    {"role": "assistant", "content": "–ü—Ä–∏—è—Ç–Ω–æ –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è, –ê–ª–µ–∫—Å–∞–Ω–¥—Ä!"},
]
rag.add_dialogue(dialogue_id, messages)

# –ò—â–µ–º —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
question = "–ö–∞–∫ –º–µ–Ω—è –∑–æ–≤—É—Ç?"
context = rag.get_relevant_context(question, dialogue_id)
print(context)  # –ù–∞–π–¥–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø—Ä–æ –∏–º—è
```

### –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

```python
# 1. –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ (–≤–µ–∫—Ç–æ—Ä–Ω—ã–π + —Ç–µ–∫—Å—Ç–æ–≤—ã–π)
results = rag.search(
    query="–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–±–æ—Ç–µ",
    dialogue_id=dialogue_id,
    top_k=5,
    use_hybrid=True
)

# 2. –ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö —Å–µ—Å—Å–∏–π
similar = rag_engine.find_similar_sessions(
    session_text="–û–±—Å—É–∂–¥–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞",
    dialogue_id=dialogue_id,
    k=3
)

# 3. –ü–æ–∏—Å–∫ –ø–æ –≤—Å–µ–º –¥–∏–∞–ª–æ–≥–∞–º
all_results = rag_engine.search_all_dialogues(
    query="–≤–∞–∂–Ω—ã–µ –¥–∞—Ç—ã",
    top_k_per_dialogue=3
)

# 4. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
analytics = rag_engine.get_dialogue_analytics(dialogue_id)
print(f"–ü—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–æ: {analytics['total_documents']} –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤")
```

## ‚öôÔ∏è –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –î–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ (>10k –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤)

```python
config = VectorRAGConfig(
    # –ë–æ–ª—å—à–µ –±–∞—Ç—á = –±—ã—Å—Ç—Ä–µ–µ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è
    embedding_batch_size=128,
    
    # GPU –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
    use_amp=True,  # Mixed precision
    compile_model=True,  # torch.compile (PyTorch 2.0+)
    
    # –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
    num_workers=8,
    prefetch_batches=4,
    
    # –ö–≤–∞–Ω—Ç–∏–∑–∞—Ü–∏—è –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –ø–∞–º—è—Ç–∏
    quantize_model=True,  # 4x –º–µ–Ω—å—à–µ –ø–∞–º—è—Ç–∏
    
    # –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
    optimize_on_save=True,
    compress_indices=True
)
```

### –í—ã–±–æ—Ä –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª–∏

| –ú–æ–¥–µ–ª—å | –†–∞–∑–º–µ—Ä | –°–∫–æ—Ä–æ—Å—Ç—å | –ö–∞—á–µ—Å—Ç–≤–æ | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
|--------|--------|----------|----------|--------------|
| rubert-tiny2 | 312MB | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê | –ë—ã—Å—Ç—Ä—ã–π –ø—Ä–æ—Ç–æ—Ç–∏–ø |
| LaBSE-en-ru | 490MB | ‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê | **–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –≤—ã–±–æ—Ä** |
| sbert_large_nlu_ru | 1.7GB | ‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ |
| multilingual-e5-base | 560MB | ‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê | –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å |

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```python
# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
stats = rag.embedding_engine.get_stats()
print(f"–ó–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–æ: {stats['total_encoded']} —Ç–µ–∫—Å—Ç–æ–≤")
print(f"Cache hit rate: {stats['cache_hit_rate']:.1%}")
print(f"–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –±–∞—Ç—á–∞: {stats['last_batch_time']:.2f}—Å")

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–∏—Å–∫–∞
analytics = rag.stores[dialogue_id].get_analytics()
print(f"–í—Å–µ–≥–æ –ø–æ–∏—Å–∫–æ–≤: {analytics['total_searches']}")
print(f"–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –ø–æ–∏—Å–∫–∞: {analytics['avg_search_time']*1000:.2f}–º—Å")
print(f"–¢–æ–ø –¥–æ–∫—É–º–µ–Ω—Ç—ã: {analytics['top_accessed_docs']}")
```

### –ë–µ–Ω—á–º–∞—Ä–∫–∏

–ù–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö (1000 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, CPU):
- **–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è**: 300 –¥–æ–∫/—Å–µ–∫
- **–ü–æ–∏—Å–∫**: 5-10 –º—Å
- **–ü–∞–º—è—Ç—å**: ~50MB –Ω–∞ 1000 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- **Cache hit rate**: 85%+ –ø–æ—Å–ª–µ –ø—Ä–æ–≥—Ä–µ–≤–∞

–° GPU (CUDA):
- **–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è**: 1000+ –¥–æ–∫/—Å–µ–∫
- **–ü–æ–∏—Å–∫**: 2-5 –º—Å
- **AMP —É—Å–∫–æ—Ä–µ–Ω–∏–µ**: 2-3x

## üõ† –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### Out of Memory

```python
# –£–º–µ–Ω—å—à–∏—Ç–µ —Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞
config.embedding_batch_size = 16

# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–≤–∞–Ω—Ç–∏–∑–∞—Ü–∏—é
config.quantize_model = True

# –í—ã–±–µ—Ä–∏—Ç–µ –º–µ–Ω—å—à—É—é –º–æ–¥–µ–ª—å
config.embedding_model = "cointegrated/rubert-tiny2"
```

### –ú–µ–¥–ª–µ–Ω–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è

```python
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ GPU
config.embedding_device = "cuda"

# –í–∫–ª—é—á–∏—Ç–µ AMP
config.use_amp = True

# –£–≤–µ–ª–∏—á—å—Ç–µ –±–∞—Ç—á
config.embedding_batch_size = 64

# –í–∫–ª—é—á–∏—Ç–µ –∫–æ–º–ø–∏–ª—è—Ü–∏—é (PyTorch 2.0+)
config.compile_model = True
```

### –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –ø–æ–∏—Å–∫–∞

```python
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª—É—á—à—É—é –º–æ–¥–µ–ª—å
config.embedding_model = "cointegrated/LaBSE-en-ru"

# –í–∫–ª—é—á–∏—Ç–µ –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫
config.use_hybrid_search = True

# –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≤–µ—Å–∞
config.vector_weight = 0.6
config.keyword_weight = 0.4

# –í–∫–ª—é—á–∏—Ç–µ –ø–µ—Ä–µ—Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ
config.enable_reranking = True
```

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è —Å —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è

```python
# –ü—Ä–æ—Å—Ç–æ –∑–∞–º–µ–Ω–∏—Ç–µ –∫–ª–∞—Å—Å –≤ model_inference.py:
from .model_inference_vector import SubmitModelWithVectorMemory

class SubmitModelWithMemory(SubmitModelWithVectorMemory):
    def __init__(self, model_path: str) -> None:
        super().__init__(
            model_path=model_path,
            use_vector_rag=True  # –í–∫–ª—é—á–∏—Ç—å –≤–µ–∫—Ç–æ—Ä–Ω—ã–π RAG
        )
```

### –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

- ‚úÖ –ü–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º API
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ Fallback –Ω–∞ —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–π RAG –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–∑–∞–≥—Ä—É–∑–∫–∞ –∏–Ω–¥–µ–∫—Å–æ–≤

## üéì –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ß–∞—Ç-–±–æ—Ç —Å –ø–∞–º—è—Ç—å—é

```python
class ChatBotWithMemory:
    def __init__(self):
        self.rag = VectorRAGInterface(
            model_name="cointegrated/LaBSE-en-ru",
            use_gpu=True
        )
        self.dialogue_id = str(uuid.uuid4())
    
    def chat(self, user_input: str) -> str:
        # –ü–æ–ª—É—á–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏
        context = self.rag.get_relevant_context(
            user_input, 
            self.dialogue_id,
            top_k=3
        )
        
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
        prompt = f"{context}\n\nUser: {user_input}\nBot:"
        response = generate_response(prompt)  # –í–∞—à–∞ –º–æ–¥–µ–ª—å
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ø–∞–º—è—Ç—å
        self.rag.process_message(user_input, self.dialogue_id, "user")
        self.rag.process_message(response, self.dialogue_id, "assistant")
        
        return response
```

### –ü—Ä–∏–º–µ—Ä 2: –ü–æ–∏—Å–∫ –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º

```python
class DocumentSearch:
    def __init__(self):
        self.rag_engine = VectorRAGEngine(
            VectorRAGConfig(
                embedding_model="intfloat/multilingual-e5-base",
                use_hybrid_search=True
            )
        )
    
    def index_documents(self, documents: List[Dict]):
        """–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤"""
        for doc in documents:
            sessions = [
                {
                    'session_id': doc['id'],
                    'text': doc['content'],
                    'metadata': {
                        'title': doc['title'],
                        'date': doc['date'],
                        'author': doc['author']
                    }
                }
            ]
            self.rag_engine.index_dialogue(doc['category'], sessions)
    
    def search(self, query: str, category: str = None) -> List[Dict]:
        """–ü–æ–∏—Å–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤"""
        if category:
            results = self.rag_engine.search_dialogue(query, category)
        else:
            all_results = self.rag_engine.search_all_dialogues(query)
            results = [r for cat_results in all_results.values() for r in cat_results]
        
        return results
```

## üìà Roadmap

### v2.1 (–ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ FAISS –¥–ª—è 1M+ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- [ ] Incremental indexing
- [ ] Cross-encoder reranking
- [ ] Automatic model selection

### v3.0 (–ë—É–¥—É—â–µ–µ)
- [ ] –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫
- [ ] Fine-tuning –º–æ–¥–µ–ª–µ–π –Ω–∞ –≤–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- [ ] GraphRAG –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- [ ] Multi-modal –ø–æ–∏—Å–∫ (—Ç–µ–∫—Å—Ç + –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)

## ü§ù –ü–æ–¥–¥–µ—Ä–∂–∫–∞

### –ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã

**Q: –ö–∞–∫—É—é –º–æ–¥–µ–ª—å –≤—ã–±—Ä–∞—Ç—å?**
A: –î–ª—è —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º `cointegrated/LaBSE-en-ru` - –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å –∫–∞—á–µ—Å—Ç–≤–∞ –∏ —Å–∫–æ—Ä–æ—Å—Ç–∏.

**Q: –ù—É–∂–µ–Ω –ª–∏ GPU?**
A: –ù–µ—Ç, –Ω–æ —Å GPU –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –±—ã—Å—Ç—Ä–µ–µ –≤ 3-5 —Ä–∞–∑. –î–ª—è <1000 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ CPU –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ.

**Q: –ö–∞–∫ —á–∞—Å—Ç–æ –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å?**
A: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑ –∫–æ—Ä–æ–±–∫–∏. –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –Ω—É–∂–Ω–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å–º–µ–Ω–µ –º–æ–¥–µ–ª–∏.

**Q: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –æ–±—ä–µ–º –¥–∞–Ω–Ω—ã—Ö?**
A: –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞ –¥–æ 100k –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤. –î–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –∂–¥–∏—Ç–µ v2.1 —Å FAISS.

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã
python test_vector_rag_isolated.py

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–º–µ—Ä—ã
python example_vector_rag_integration.py
```

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License - —Å–≤–æ–±–æ–¥–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è.

---

**–°–¥–µ–ª–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ GigaChat**
