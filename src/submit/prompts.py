"""
Файл с промптами для модуля памяти GigaMemory
"""

def get_memory_extraction_prompt(question: str, memory_text: str) -> str:
    """
    Генерирует промпт для извлечения информации из памяти
    
    Args:
        question: Вопрос пользователя
        memory_text: Текст накопленной памяти
    
    Returns:
        Готовый промпт для модели
    """
    return f"""ТЫ - ЭКСПЕРТ ПО АНАЛИЗУ ЛИЧНОЙ ИНФОРМАЦИИ! Найди точные факты о пользователе из его сообщений.

ЭТАП 1 - АНАЛИЗ ВОПРОСА:
Разбери вопрос "{question}" по словам. Пойми суть: что именно нужно найти?

ЭТАП 2 - СТРУКТУРА СЕССИЙ:
Сообщения идут хронологически: Сессия 1 → Сессия 25
При противоречиях - бери из ПОЗДНЕЙ сессии
Сообщения с [ЛИЧНОЕ] содержат ключевую информацию

ЭТАП 3 - ЧТЕНИЕ:
Прочитай ВСЕ сообщения подряд, ищи упоминания ответа.
Особое внимание - сообщениям с [ЛИЧНОЕ]

ЭТАП 4 - ПРОВЕРКА:
Найди сообщения с ответом на вопрос.
Перечитай их 2-3 раза, дочитывай до конца фраз.

ЭТАП 5 - ОТВЕТ:
Найди ответ на "{question}". Отвечай кратко 1 предложением!

ПРАВИЛА:
• Найден факт → четкий ответ
• Косвенные упоминания тоже считаются
• Нет данных → "У меня нет такой информации"
• Несколько вариантов → через запятую

ФОРМАТ: Краткий ответ или "У меня нет такой информации"

СООБЩЕНИЯ:
{memory_text}"""


def get_session_marker_prompt(session_id: int) -> str:
    """
    Генерирует маркер сессии для сообщения
    
    Args:
        session_id: Номер сессии
    
    Returns:
        Строка с маркером сессии
    """
    return f"[Сессия {session_id}]"


def get_personal_info_marker() -> str:
    """
    Возвращает маркер для особо важной личной информации
    
    Returns:
        Строка с маркером личной информации
    """
    return "[ЛИЧНОЕ]"


# Альтернативные промпты (можно экспериментировать)

def get_memory_extraction_prompt_v2(question: str, memory_text: str) -> str:
    """
    Альтернативная версия промпта - более короткая и прямая
    """
    return f"""Найди в сообщениях пользователя ответ на вопрос: {question}

ПРАВИЛА:
1. Ищи факты только в сообщениях ниже
2. При противоречиях бери информацию из более поздних сессий
3. Если ответа нет, пиши "У меня нет такой информации"
4. Ответ максимум 1 предложение

СООБЩЕНИЯ:
{memory_text}

ОТВЕТ:"""


def get_memory_extraction_prompt_v3(question: str, memory_text: str) -> str:
    """
    Версия с акцентом на точность
    """
    return f"""Система анализа памяти. Вопрос: {question}

Инструкции:
- Читай только предоставленные сообщения
- Ответ строго по фактам из сообщений
- Новые сессии важнее старых
- Без додумывания и предположений

Сообщения для анализа:
{memory_text}

Твой ответ (1 предложение):"""
